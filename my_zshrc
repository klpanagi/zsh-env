# Check if zplug is installed
if [[ ! -d ~/.zplug ]]; then
    git clone https://github.com/zplug/zplug ~/.zplug
    source ~/.zplug/init.zsh && zplug update --self
fi
source $HOME/.zplug/init.zsh

#ZPLUG_PROTOCOL="SSH"
#ZPLUG_USE_CACHE=true

## Bundles {
zplug 'zplug/zplug', hook-build:'zplug --self-manage'
zplug "robbyrussell/oh-my-zsh", use:"lib/*.zsh"
zplug "plugins/command-not-found", from:oh-my-zsh
zplug "plugins/z", from:oh-my-zsh
zplug "plugins/git", from:oh-my-zsh
zplug "plugins/colorize", from:oh-my-zsh
zplug "plugins/pip", from:oh-my-zsh
zplug "plugins/cp", from:oh-my-zsh
zplug "plugins/colored-man-pages", from:oh-my-zsh

zplug "zsh-users/zsh-completions",              defer:0
zplug "zsh-users/zsh-autosuggestions",          defer:2, on:"zsh-users/zsh-completions"
zplug "zsh-users/zsh-syntax-highlighting",      defer:3, on:"zsh-users/zsh-autosuggestions"
zplug "zsh-users/zsh-history-substring-search", defer:3, on:"zsh-users/zsh-syntax-highlighting"
zplug "plugins/ssh-agent", from:oh-my-zsh
zplug "supercrabtree/k"
# }

# Theme ----------{
setopt prompt_subst
zplug "caiogondim/bullet-train-oh-my-zsh-theme", \
    use:"bullet-train.zsh-theme", \
    as:theme
# ----------}

if ! zplug check --verbose; then
    printf "Install zsh plugin? [y/N]: "
    if read -q; then
        echo; zplug install
    fi
fi

# Then, source plugins and add commands to $PATH
zplug load

zmodload zsh/terminfo
## zsh-history-substring-search {
bindkey "$terminfo[kcuu1]" history-substring-search-up
bindkey "$terminfo[kcud1]" history-substring-search-down
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down

## VI mode
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down]]]]
## }

## zsh-autosuggestions --{
bindkey '^ ' autosuggest-execute
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=39"
## --}

# ZSH History config ----------{
setopt append_history
setopt hist_expire_dups_first
setopt hist_fcntl_lock
setopt hist_ignore_all_dups
setopt hist_lex_words
setopt hist_reduce_blanks
setopt hist_save_no_dups
setopt share_history
# ----------}

export BROWSER="firefox"

## Compiler
export CC=/usr/bin/gcc
export CXX=/usr/bin/g++

# Locale
export LANG=en_US.UTF-8

export TERM="xterm-256color"
export TERMINAL="terminator"

# If not tmux session
#[[ $TMUX = "" ]] && export TERM="rxvt-unicode"

CASE_SENSITIVE="true"
# HYPHEN_INSENSITIVE="true"
DISABLE_AUTO_UPDATE="true"
# export UPDATE_ZSH_DAYS=13
# DISABLE_LS_COLORS="true"
DISABLE_AUTO_TITLE="true"
ENABLE_CORRECTION="true"
COMPLETION_WAITING_DOTS="true"
# DISABLE_UNTRACKED_FILES_DIRTY="true"
HIST_STAMPS="mm/dd/yyyy"

if [ -d "$HOME/.local/bin" ]; then
  PATH="$HOME/.local/bin:$PATH"
fi

if [ -d "$HOME/.local/lib" ]; then
  LD_LIBRARY_PATH="$HOME/.local/lib:$LD_LIBRARY_PATH"
fi

export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/lib/x86_64-linux-gnu/pkgconfig:/usr/local/lib/pkgconfig:/usr/lib/pkgconfig

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
    export EDITOR='gvim'
else
    export EDITOR='vim'
fi

# Compilation flags
# export ARCHFLAGS="-arch x86_64"

# ssh
# export SSH_KEY_PATH="~/.ssh/id_rsa"

# Bullettrain Theme ----------{
BULLETTRAIN_PROMPT_ORDER=(
  status
  cmd_exec_time
  context
  dir
  git
  virtualenv
)
  # Prompt
BULLETTRAIN_PROMPT_ROOT=true
BULLETTRAIN_PROMPT_CHAR="âž” "
BULLETTRAIN_PROMPT_SEPARATE_LINE=true
BULLETTRAIN_PROMPT_ADD_NEWLINE=true

# Status
BULLETTRAIN_STATUS_BG="green"
BULLETTRAIN_STATUS_ERROR_BG="red"
BULLETTRAIN_STATUS_FG="white"

# Context
BULLETTRAIN_IS_SSH_CLIENT=true
BULLETTRAIN_CONTEXT_BG="black"
BULLETTRAIN_CONTEXT_FG="yellow"
BULLETTRAIN_CONTEXT_DEFAULT_USER="klpanagi"

# Dir
BULLETTRAIN_DIR_BG="black"
BULLETTRAIN_DIR_FG="yellow"
BULLETTRAIN_DIR_CONTEXT_SHOW=false
BULLETTRAIN_DIR_EXTENDED=1

# Git
BULLETTRAIN_GIT_BG="black"
BULLETTRAIN_GIT_FG="white"
BULLETTRAIN_GIT_COLORIZE_DIRTY=true
BULLETTRAIN_GIT_COLORIZE_DIRTY_BG_COLOR="black"
BULLETTRAIN_GIT_COLORIZE_DIRTY_FG_COLOR="cyan"

# Command execution
BULLETTRAIN_EXEC_TIME_BG="blue"
BULLETTRAIN_EXEC_TIME_FG="white"
BULLETTRAIN_EXEC_TIME_ELAPSED=20

# Python virtualenv
BULLETTRAIN_VIRTUALENV_BG="yellow"
BULLETTRAIN_VIRTUALENV_FG="black"
BULLETTRAIN_VIRTUALENV_PREFIX="pyenv"
# ----------}

### Tmux ----------{
ZSH_TMUX_AUTOSTART=false
ZSH_TMUX_AUTOCONNECT=true
ZSH_TMUX_FIXTERM_WITH_256COLOR=true
# ----------}

# Aliases ----------{
if [ -f "${HOME}/.zsh_aliases" ]; then
    source ~/.zsh_aliases
fi
# ----------}

# ROS {
if [ -d "/opt/ros/indigo" ]; then
    source /opt/ros/indigo/setup.zsh --extend
fi
# }

# RAPP-Platform {
if [ -d "${HOME}/rapp_platform" ]; then
    source ${HOME}/rapp_platform/rapp_platform_setup.zsh
fi
# }

# vim-mode
#bindkey -v

# export PYTHONPATH=$PYTHONPATH:${HOME}/Desktop/Diploma-Thesis/ai-playground/deep-learning/lib

## FZF plugin ----------{
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
    export FZF_COMPLETION_TRIGGER=',,' # Trigger Sequence (,,<TAB>)
FZH_TMUX_HEIGHT=40 # Control fzf pane height
# ----------}

export WORKON_HOME=~/.virtuanenvs
source /usr/local/bin/virtualenvwrapper.sh
source /usr/local/bin/activate.sh
